parameters:
  EnvironmentName: ''
  IntegrationTestEnabled: ''
  IntegrationTestPackage: ''
  IntegrationTestProjectFolder: ''

steps:
- task: ExtractFiles@1
  condition: eq('${{ parameters.IntegrationTestEnabled }}', true)
  displayName: Extract files
  inputs:
    archiveFilePatterns: '${{ parameters.IntegrationTestPackage }}'
    destinationFolder: '${{ parameters.IntegrationTestProjectFolder }}'

- task: VSTest@2
  condition: eq('${{ parameters.IntegrationTestEnabled }}', true)
  displayName: 'VsTest - run IntegrationTests'
  inputs:
    testAssemblyVer2: |
     **\*Tests.dll
     !**\*TestAdapter.dll
     !**\obj\**
    searchFolder: '${{ parameters.IntegrationTestProjectFolder }}'
  continueOnError: true

- task: DeleteFiles@1
  displayName: 'Delete appsettings.json'
  inputs:
    SourceFolder: '${{ parameters.IntegrationTestProjectFolder }}'
    Contents: appsettings.json
  condition: always()